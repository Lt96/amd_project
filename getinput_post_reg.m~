
    xDoc= xmlread('reg_images.xml');
    list=dir('./Reg Set/');
    list = setdiff({list.name},{'.','..','.DS_Store'});
    
    imgDoc = xmlread('images.xml');
    images = imgDoc.getElementsByTagName('image');
    
    for i=1:length(list)
        
        if isdir(list{i})
            id=list{i};
            path = strcat('./Reg Set/',list{i},'/');
            sublist = dir(path);
            pics = setdiff({sublist.name},{'.','..','.DS_Store'});
             for j=1:length(pics)
                file = pics{j};
                [regpth, regname,ext] = fileparts(file);

                if isequal(file,0)
                    error('Error in specifiying the file');
                end

                
                newImage = xDoc.createElement('image');
                
                img = imread(strcat(path, file));
                figure(1);imshow(img);title(file);
                
                if ~isempty(strfind(file,'_corrimg'));
                    type = 'corr';
                elseif ~isempty(strfind(file,'_baseimg'));
                    type = 'base';
                else 
                    error('Error: Images do not appear to be registered');                
                end
                
                if strcmpi(type,'base')
                    

                    index  = strfind(file,'-');
                    identifier = regname(index-3:index-1);
                    
                    for count = 1:images.getLength
                        image = images.item(count - 1);
                        if strcmpi(id, image.getAttribute('id'))
                            path = char(image.getAttribute('path'));
                            [pathstr, name, ext] = fileparts(path);
                            srchstrn = name(end-2:end);
                                if strcmpi(srchstrn,identifier);
                                    time = char(image.getAttribute('time'));
                                    break
                                end
                        end
                    end

                   
                   
                    [xin,yin] = ginput(2);

                    macula_xml = xDoc.createElement('macula');
                    macula_x = round(xin(1));
                    x = xDoc.createElement('x');
                    x.appendChild(xDoc.createTextNode(sprintf('%i',macula_x)));
                    macula_xml.appendChild(x);

                    macula_y = round(yin(1));
                    y = xDoc.createElement('y');
                    y.appendChild(xDoc.createTextNode(sprintf('%i',macula_y)));
                    macula_xml.appendChild(y);

                    optic_xml = xDoc.createElement('optic_disk');
                    optic_x = round(xin(2));
                    x = xDoc.createElement('x');
                    x.appendChild(xDoc.createTextNode(sprintf('%i',optic_x)));
                    optic_xml.appendChild(x);

                    optic_y = round(yin(2));
                    y = xDoc.createElement('y');
                    y.appendChild(xDoc.createTextNode(sprintf('%i',optic_y)));
                    optic_xml.appendChild(y);

                    newImage.appendChild(macula_xml);
                    newImage.appendChild(optic_xml);
                    
                elseif strcmpi(type, 'corr')
                    
                    identifier = regname(end-2:end);
                    
                    for count = 1:images.getLength
                        image = images.item(count - 1);
                        if strcmpi(id, image.getAttribute('id'))
                            path = char(image.getAttribute('path'));
                            [pathstr, name, ext] = fileparts(path);
                            srchstrn = name(end-2:end);
                                if strcmpi(srchstrn,identifier);
                                    time = char(image.getAttribute('time'));
                                    break
                                end
                        end
                    end
                end
                
                
                newImage.setAttribute('path', file);
                newImage.setAttribute('time',time);
                newImage.setAttribute('id',id);
               
                xDoc.getDocumentElement.appendChild(newImage);

                xmlwrite('reg_images.xml', newImage);
             end
        end
    end

